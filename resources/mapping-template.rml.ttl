@prefix rml: <http://w3id.org/rml/> .
@prefix ex: <http://example.com/ns#> .
@prefix o-steps: <https://fast.ilabt.imec.be/ns/oslo-steps/0.2#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix o-persoon: <https://data.vlaanderen.be/ns/persoon#> .
@prefix formats: <http://www.w3.org/ns/formats/> .
@prefix xl: <http://www.w3.org/2008/05/skos-xl#> .

@base <http://example.com/base/> .

#########################
# Mapping of the shapes #
#########################

<ShapesSource>
  a rml:LogicalSource ;
  rml:referenceFormulation rml:CSV ;
  rml:source [
    a rml:FilePath ;
    rml:path "@@SHAPES.CSV@@"
  ]
  .

<ShapesTarget>
  a rml:logicalTarget ;
  rml:serialization formats:Turtle;
  rml:target [
    a rml:Target, rml:FilePath ;
    rml:path "@@SHAPES.TTL@@"
  ]
  .

<ShapesMap>
  a rml:TriplesMap ;
  rml:logicalSource <ShapesSource>;

  rml:subjectMap [
    a rml:subjectMap ;
    rml:class o-steps:StateShape ;
    rml:template "http://example.com/shapes#{name}";
    rml:logicalTarget <ShapesTarget>
  ];

  rml:predicateObjectMap [
    a rml:PredicateObjectMap ;
    rml:predicateMap [
      a rml:PredicateMap ;
      rml:constant rdfs:label
    ];
    rml:objectMap [
      a rml:ObjectMap ;
      rml:constant "TODO: provide a description";
    ];
  ];

  rml:predicateObjectMap [
    a rml:PredicateObjectMap ;
    rml:predicateMap [
      a rml:PredicateMap ;
      rml:constant sh:TargetClass
    ];
    rml:objectMap [
      a rml:ObjectMap ;
      rml:constant o-persoon:Inwoner
    ]
  ];

  rml:predicateObjectMap [
    a rml:PredicateObjectMap ;
    rml:predicateMap [
      a rml:PredicateMap ;
      rml:constant sh:property
    ];
    rml:objectMap [
      a rml:ObjectMap ;
      rml:template "http://example.com/shapes#{name}PropertyShape"
    ]
  ]
  .

<PropertyShapesMap>
  a rml:TriplesMap ;
  rml:logicalSource <ShapesSource>;

  rml:subjectMap [
    a rml:subjectMap ;
    rml:class sh:PropertyShape ;
    rml:template "http://example.com/shapes#{name}PropertyShape" ;
    rml:logicalTarget <ShapesTarget>
  ];

  rml:predicateObjectMap [
    a rml:PredicateObjectMap ;
    rml:predicateMap [
      a rml:PredicateMap ;
      rml:constant rdfs:label
    ];
    rml:objectMap [
      a rml:ObjectMap ;
      rml:constant "TODO: provide a description";
    ];
  ];
  .


#########################
# Mapping of the states #
#########################

<StatesSource>
  a rml:LogicalSource ;
  rml:referenceFormulation rml:CSV ;
  rml:source [
    a rml:FilePath ;
    rml:path "@@STATES.CSV@@"
  ]
  .

<StatesTarget>
  a rml:logicalTarget ;
  rml:serialization formats:Turtle;
  rml:target [
    a rml:Target, rml:FilePath ;
    rml:path "@@STATES.TTL@@"
  ]
  .

<StatesMap>
  a rml:TriplesMap ;
  rml:logicalSource <StatesSource>;

  rml:subjectMap [
    a rml:subjectMap ;
    rml:class o-steps:State ;
    rml:template "http://example.com/states#{name}" ;
    rml:logicalTarget <StatesTarget>
  ];

  rml:predicateObjectMap [
    a rml:PredicateObjectMap ;
    rml:predicateMap [
      a rml:PredicateMap ;
      rml:constant rdfs:label
    ];
    rml:objectMap [
      a rml:ObjectMap ;
      rml:reference "description"
    ];
  ];

  rml:predicateObjectMap [
    a rml:PredicateObjectMap ;
    rml:predicateMap [
      a rml:PredicateMap ;
      rml:constant o-steps:hasStateShape
    ];
    rml:objectMap [
      a rml:ObjectMap ;
      rml:template "http://example.com/shapes#{shape}"
    ];
  ]
  .

########################
# Mapping of the steps #
########################

<StepsSource>
  a rml:LogicalSource ;
  rml:referenceFormulation rml:CSV ;
  rml:source [
    a rml:FilePath ;
    rml:path "@@STEPS.CSV@@"
  ]
  .

<StepsTarget>
  a rml:logicalTarget ;
  rml:serialization formats:Turtle;
  rml:target [
    a rml:Target, rml:FilePath ;
    rml:path "@@STEPS.TTL@@"
  ]
  .

<StepsMap>
  a rml:TriplesMap ;
  rml:logicalSource <StepsSource>;

  rml:subjectMap [
    a rml:subjectMap ;
    rml:template "http://example.com/steps#{name}" ;
    rml:logicalTarget <StepsTarget>
  ];

  rml:predicateObjectMap [
    a rml:PredicateObjectMap ;
    rml:predicateMap [
      a rml:PredicateMap ;
      rml:constant rdf:type
    ];
    rml:objectMap [
      a rml:ObjectMap ;
      rml:template "https://fast.ilabt.imec.be/ns/oslo-steps/0.2#{level}LevelStep"
    ];
  ];

  # The descriptions themselves are generated in <StepsDescriptionMap>
  rml:predicateObjectMap [
    a rml:PredicateObjectMap ;
    rml:predicateMap [
      a rml:PredicateMap ;
      rml:constant o-steps:hasDescription
    ];
    rml:objectMap [
      a rml:ObjectMap ;
      rml:reference "name" ;
      rml:termType rml:BlankNode
    ];
  ]

  # TODO: map requiresState, BUT: can be "empty" !

  .

<StepsDescriptionMap>
  a rml:TriplesMap ;
  rml:logicalSource <StepsSource>;

  rml:subjectMap [
    a rml:subjectMap ;
    rml:template "{name}" ;
    rml:termType rml:BlankNode ;
    rml:logicalTarget <StepsTarget>
  ];

  rml:predicateObjectMap [
    a rml:PredicateObjectMap ;
    rml:predicateMap [
      a rml:PredicateMap ;
      rml:constant xl:literalForm
    ];
    rml:objectMap [
      a rml:ObjectMap ;
      rml:reference "description"
    ];
  ]
  .